<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Test your knowledge of European capital cities with this interactive quiz game">
    <meta name="theme-color" content="#0f1729">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="icon" type="image/png" href="icons/icon-192.png">

    <title>European Capitals Quiz</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Source+Sans+3:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="src/styles/main.css">

</head>
<body>
<div class="background-decoration" aria-hidden="true"></div>

<!-- Loading Screen -->
<div id="loading-screen" class="loading-screen" role="status" aria-live="polite">
    <div class="loader">
        <div class="loader-spinner"></div>
        <p data-i18n="loading.text">Loading quiz...</p>
    </div>
</div>

<!-- Top Controls -->
<div class="top-controls">
    <!-- User Profile -->
    <div id="user-profile" class="user-profile" hidden>
        <button id="user-menu-toggle" class="user-menu-toggle" aria-label="User menu">
            <img id="user-avatar" class="user-avatar" src="" alt="" />
            <span id="user-name" class="user-name">Guest</span>
            <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9l6 6 6-6"/>
            </svg>
        </button>
        <div id="user-dropdown" class="user-dropdown" hidden>
            <div class="user-dropdown-header">
                <span id="user-dropdown-email" class="user-dropdown-email"></span>
            </div>
            <button id="edit-profile-btn" class="user-dropdown-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                <span data-i18n="profile.editProfile">Edit Profile</span>
            </button>
            <button id="reset-progress-btn" class="user-dropdown-item user-dropdown-item--danger">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    <line x1="10" y1="11" x2="10" y2="17"/>
                    <line x1="14" y1="11" x2="14" y2="17"/>
                </svg>
                <span data-i18n="auth.resetProgress">Reset Progress</span>
            </button>
            <button id="logout-btn" class="user-dropdown-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16 17 21 12 16 7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                <span data-i18n="auth.signOut">Sign Out</span>
            </button>
            <div class="user-dropdown-divider"></div>
            <button id="delete-account-btn" class="user-dropdown-item user-dropdown-item--danger">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="15" y1="9" x2="9" y2="15"/>
                    <line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
                <span data-i18n="auth.deleteAccount">Delete Account</span>
            </button>
        </div>
    </div>

    <!-- Language Selector -->
    <div class="language-selector">
        <button id="language-toggle" class="language-toggle" aria-label="Change language" title="Change language">
            <svg class="globe-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <circle cx="12" cy="12" r="10"/>
                <path d="M2 12h20"/>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
            </svg>
            <span id="current-lang-code" class="current-lang-code">EN</span>
        </button>
        <div id="language-dropdown" class="language-dropdown" hidden>
            <button class="language-option" data-lang="en">
                <span class="lang-code">EN</span>
                <span class="lang-name">English</span>
            </button>
            <button class="language-option" data-lang="de">
                <span class="lang-code">DE</span>
                <span class="lang-name">Deutsch</span>
            </button>
            <button class="language-option" data-lang="es">
                <span class="lang-code">ES</span>
                <span class="lang-name">Espa√±ol</span>
            </button>
            <button class="language-option" data-lang="fr">
                <span class="lang-code">FR</span>
                <span class="lang-name">Fran√ßais</span>
            </button>
            <button class="language-option" data-lang="it">
                <span class="lang-code">IT</span>
                <span class="lang-name">Italiano</span>
            </button>
            <button class="language-option" data-lang="nl">
                <span class="lang-code">NL</span>
                <span class="lang-name">Nederlands</span>
            </button>
            <button class="language-option" data-lang="pl">
                <span class="lang-code">PL</span>
                <span class="lang-name">Polski</span>
            </button>
            <button class="language-option" data-lang="pt">
                <span class="lang-code">PT</span>
                <span class="lang-name">Portugu√™s</span>
            </button>
            <button class="language-option" data-lang="ro">
                <span class="lang-code">RO</span>
                <span class="lang-name">Rom√¢nƒÉ</span>
            </button>
            <button class="language-option" data-lang="sv">
                <span class="lang-code">SV</span>
                <span class="lang-name">Svenska</span>
            </button>
        </div>
    </div>

    <!-- Theme Toggle -->
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark/light theme" title="Toggle theme">
        <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
        <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
    </button>
</div>

<!-- Confetti Canvas -->
<canvas id="confetti-canvas" aria-hidden="true"></canvas>

<main class="container" role="main">
    <!-- Login Screen -->
    <section id="login-screen" class="screen active" aria-labelledby="login-title">
        <div class="card">
            <div class="card-decoration" aria-hidden="true"></div>
            <div class="logo" aria-hidden="true">
                <span class="compass">‚óà</span>
            </div>
            <h1 id="login-title" data-i18n="app.title">European Capitals</h1>
            <p class="subtitle" data-i18n="auth.welcome">Sign in to track your progress</p>

            <!-- Login Form -->
            <div id="auth-form-container" class="auth-form-container">
                <!-- Sign In Form -->
                <form id="signin-form" class="auth-form">
                    <div class="form-group">
                        <label for="signin-email" data-i18n="auth.email">Email</label>
                        <input type="email" id="signin-email" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label for="signin-password" data-i18n="auth.password">Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="signin-password" required autocomplete="current-password">
                            <button type="button" class="password-toggle" aria-label="Show password" data-visible="false">
                                <!-- Eye open: password is hidden, click to show -->
                                <svg class="eye-show" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                <!-- Eye with slash: password is visible, click to hide -->
                                <svg class="eye-hide" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                    <line x1="1" y1="1" x2="23" y2="23" stroke-width="2.5"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <p id="signin-error" class="auth-error" hidden></p>
                    <button type="submit" class="btn btn-primary btn-full">
                        <span data-i18n="auth.signIn">Sign In</span>
                    </button>
                    <button type="button" id="forgot-password-btn" class="btn-link forgot-password-link" data-i18n="auth.forgotPassword">Forgot password?</button>
                </form>

                <!-- Forgot Password Form -->
                <form id="forgot-password-form" class="auth-form" hidden>
                    <p class="auth-form-desc" data-i18n="auth.forgotPasswordDesc">Enter your email and we'll send you a link to reset your password.</p>
                    <div class="form-group">
                        <label for="reset-email" data-i18n="auth.email">Email</label>
                        <input type="email" id="reset-email" required autocomplete="email">
                    </div>
                    <p id="reset-error" class="auth-error" hidden></p>
                    <p id="reset-success" class="auth-success" hidden data-i18n="auth.resetEmailSent">Password reset email sent! Check your inbox.</p>
                    <button type="submit" class="btn btn-primary btn-full">
                        <span data-i18n="auth.sendResetLink">Send Reset Link</span>
                    </button>
                    <button type="button" id="back-to-signin-btn" class="btn-link" data-i18n="auth.backToSignIn">Back to sign in</button>
                </form>

                <!-- Sign Up Form (hidden by default) -->
                <form id="signup-form" class="auth-form" hidden>
                    <div class="form-group">
                        <label for="signup-email" data-i18n="auth.email">Email</label>
                        <input type="email" id="signup-email" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label for="signup-password" data-i18n="auth.password">Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="signup-password" required autocomplete="new-password" minlength="6">
                            <button type="button" class="password-toggle" aria-label="Show password" data-visible="false">
                                <!-- Eye open: password is hidden, click to show -->
                                <svg class="eye-show" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                                <!-- Eye with slash: password is visible, click to hide -->
                                <svg class="eye-hide" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                    <line x1="1" y1="1" x2="23" y2="23" stroke-width="2.5"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <p id="signup-error" class="auth-error" hidden></p>
                    <button type="submit" class="btn btn-primary btn-full">
                        <span data-i18n="auth.createAccount">Create Account</span>
                    </button>
                </form>

                <!-- Toggle between Sign In / Sign Up -->
                <p class="auth-toggle">
                    <span id="auth-toggle-text" data-i18n="auth.noAccount">Don't have an account?</span>
                    <button type="button" id="auth-toggle-btn" class="btn-link" data-i18n="auth.signUp">Sign Up</button>
                </p>

                <div class="auth-divider">
                    <span data-i18n="auth.or">or</span>
                </div>

                <!-- Social & Guest Login -->
                <div class="auth-alternatives">
                    <button id="google-signin-btn" class="btn btn-google">
                        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        <span data-i18n="auth.continueWithGoogle">Continue with Google</span>
                    </button>
                    <button id="guest-signin-btn" class="btn btn-secondary btn-full">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        <span data-i18n="auth.playAsGuest">Play as Guest</span>
                    </button>
                </div>

                <!-- Verification Pending -->
                <div id="verification-pending" class="verification-pending" hidden>
                    <div class="verification-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <polyline points="22,6 12,13 2,6"/>
                        </svg>
                    </div>
                    <h3 data-i18n="auth.verifyEmailTitle">Check your email</h3>
                    <p data-i18n="auth.verifyEmailMessage">We've sent a verification link to your email. Please verify your email to continue.</p>
                    <p id="verification-email" class="verification-email"></p>
                    <div class="verification-actions">
                        <button id="resend-verification-btn" class="btn btn-secondary">
                            <span data-i18n="auth.resendEmail">Resend Email</span>
                        </button>
                        <button id="check-verification-btn" class="btn btn-primary">
                            <span data-i18n="auth.iVerified">I've Verified</span>
                        </button>
                    </div>
                    <button id="back-to-login-btn" class="btn-link" data-i18n="auth.backToLogin">Back to login</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Start Screen -->
    <section id="start-screen" class="screen" aria-labelledby="start-title">
        <div class="card">
            <div class="card-decoration" aria-hidden="true"></div>
            <div class="logo" aria-hidden="true">
                <span class="compass">‚óà</span>
            </div>
            <h1 id="start-title" data-i18n="app.title">European Capitals</h1>
            <p class="subtitle" data-i18n="app.subtitle">Test your knowledge of Europe's capital cities</p>

            <div class="stats-preview" aria-label="Quiz statistics">
                <div class="stat">
                    <span class="stat-number" id="total-question-count">0</span>
                    <span class="stat-label" data-i18n="start.questions">Questions</span>
                </div>
                <div class="stat">
                    <span class="stat-number">4</span>
                    <span class="stat-label" data-i18n="start.optionsEach">Options each</span>
                </div>
            </div>

            <form id="quiz-settings" class="settings" aria-label="Quiz settings">
                <div class="setting-group">
                    <label for="player-name" data-i18n="settings.yourName">Your name:</label>
                    <input type="text" id="player-name" data-i18n="[placeholder]settings.enterName" placeholder="Enter your name" maxlength="30" autocomplete="name">
                </div>
                <div class="setting-group game-mode-group">
                    <label data-i18n="settings.gameMode">Game Mode:</label>
                    <div class="game-mode-options">
                        <label class="game-mode-option">
                            <input type="radio" name="game-mode" value="classic" checked>
                            <span class="game-mode-label">
                                <span class="game-mode-name" data-i18n="settings.classic">Classic</span>
                                <span class="game-mode-desc" data-i18n="settings.classicDesc">Fixed questions, per-question timer</span>
                            </span>
                        </label>
                        <label class="game-mode-option">
                            <input type="radio" name="game-mode" value="speedrun">
                            <span class="game-mode-label">
                                <span class="game-mode-name" data-i18n="settings.speedRun">Speed Run</span>
                                <span class="game-mode-desc" data-i18n="settings.speedRunDesc">60 seconds, answer as many as you can</span>
                            </span>
                        </label>
                    </div>
                </div>
                <div class="setting-group">
                    <label for="difficulty-select" data-i18n="settings.difficulty">Difficulty:</label>
                    <select id="difficulty-select" aria-describedby="difficulty-hint">
                        <option value="easy" data-i18n="difficulty.easy">Easy</option>
                        <option value="medium" selected data-i18n="difficulty.medium">Medium</option>
                        <option value="hard" data-i18n="difficulty.hard">Hard</option>
                    </select>
                    <p class="difficulty-hint" id="difficulty-hint" data-i18n="difficulty.mediumHint">Cities from the same country and one foreign city</p>
                </div>
                <div class="setting-group">
                    <label for="timer-select" data-i18n="settings.timer">Timer:</label>
                    <select id="timer-select">
                        <option value="0" data-i18n="timer.none">No timer</option>
                        <option value="10" data-i18n="timer.10sec">10 seconds</option>
                        <option value="15" selected data-i18n="timer.15sec">15 seconds</option>
                        <option value="20" data-i18n="timer.20sec">20 seconds</option>
                        <option value="30" data-i18n="timer.30sec">30 seconds</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label for="region-select" data-i18n="settings.region">Region:</label>
                    <select id="region-select">
                        <!-- Options populated dynamically from JSON -->
                    </select>
                </div>
                <div class="setting-group">
                    <label for="question-count" data-i18n="settings.numQuestions">Number of questions:</label>
                    <select id="question-count">
                        <!-- Options populated dynamically based on available questions -->
                    </select>
                </div>
                <p class="available-count">
                    <span id="available-questions">45</span> <span data-i18n="start.questionsAvailable">questions available</span>
                </p>
            </form>

            <button id="start-btn" class="btn btn-primary" type="button">
                <span data-i18n="buttons.beginQuiz">Begin Quiz</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </button>
        </div>
    </section>

    <!-- Quiz Screen -->
    <section id="quiz-screen" class="screen" aria-labelledby="question-text">
        <div class="card">
            <div class="card-decoration" aria-hidden="true"></div>
            <button id="quit-btn" class="quiz-close-btn" aria-label="End game" title="End game" style="display: none;">&times;</button>

            <header class="quiz-header">
                <div class="progress-info" aria-label="Question progress">
                    <span id="current-question">1</span>
                    <span class="separator" aria-hidden="true">/</span>
                    <span id="total-questions">20</span>
                </div>
                <div class="region-badge" id="region-badge" aria-label="Selected region">All of Europe</div>
                <div id="streak-display" class="streak-display" aria-label="Current streak" hidden>
                    <span class="streak-icon">üî•</span>
                    <span id="streak-count">0</span>
                </div>
                <div class="score-display" aria-label="Current score">
                    <span class="score-label" data-i18n="quiz.score">Score</span>
                    <span id="current-score">0</span>
                </div>
            </header>

            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div id="progress-fill" class="progress-fill"></div>
            </div>

            <!-- Timer -->
            <div id="timer-container" class="timer-container" role="timer" aria-live="polite" aria-label="Time remaining">
                <svg class="timer-svg" viewBox="0 0 100 100" aria-hidden="true">
                    <circle class="timer-bg" cx="50" cy="50" r="45"/>
                    <circle id="timer-circle" class="timer-progress" cx="50" cy="50" r="45"/>
                </svg>
                <span id="timer-text" class="timer-text">15</span>
            </div>

            <div class="question-container">
                <div class="question-with-flag">
                    <img id="question-flag" class="question-flag" src="" alt="" aria-hidden="true">
                    <h2 id="question-text"></h2>
                </div>
            </div>

            <!-- Hints -->
            <div class="hints-container" role="group" aria-label="Hint options">
                <button id="hint-letter" class="btn-hint" aria-label="Reveal first letter hint">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    <span data-i18n="hints.firstLetter">First Letter</span>
                    <span class="hint-count" id="hint-letter-count">2</span>
                </button>
                <button id="hint-eliminate" class="btn-hint" aria-label="Eliminate one wrong answer">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M15 9l-6 6M9 9l6 6"/>
                    </svg>
                    <span data-i18n="hints.eliminateOne">Eliminate One</span>
                    <span class="hint-count" id="hint-eliminate-count">2</span>
                </button>
            </div>

            <div id="options-container" class="options-container" role="group" aria-label="Answer options">
                <!-- Options will be inserted here -->
            </div>

            <!-- Map Preview -->
            <div id="map-container" class="map-container" aria-label="Country information">
                <div class="map-wrapper">
                    <p class="map-title" data-i18n="quiz.countryInfo">üìç Country Info</p>
                    <div class="map-content">
                        <div class="map-flag-section">
                            <img id="map-image" src="" alt="" class="map-image">
                        </div>
                        <div class="map-geo-section">
                            <div id="europe-map-container" class="europe-map-container">
                                <!-- Google Maps iframe will be injected here -->
                            </div>
                        </div>
                    </div>
                    <p id="map-caption" class="map-caption"></p>
                    <div id="fun-fact" class="fun-fact" hidden>
                        <span class="fun-fact-icon">üí°</span>
                        <p id="fun-fact-text" class="fun-fact-text"></p>
                    </div>
                </div>
            </div>

            <button id="next-btn" class="btn btn-primary" disabled>
                <span data-i18n="buttons.nextQuestion">Next Question</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </button>
        </div>
    </section>

    <!-- Results Screen -->
    <section id="results-screen" class="screen" aria-labelledby="results-title">
        <div class="card">
            <div class="card-decoration" aria-hidden="true"></div>

            <div id="results-icon" class="results-icon" aria-hidden="true">
                <span class="trophy">‚òÖ</span>
            </div>

            <h1 id="results-title" data-i18n="results.complete">Quiz Complete!</h1>
            <p id="results-message" class="results-message"></p>

            <div class="final-score" aria-label="Final score">
                <div class="score-circle">
                    <span id="final-score-value">0</span>
                    <span class="score-divider" aria-hidden="true">/</span>
                    <span id="final-total">20</span>
                </div>
                <p class="score-percentage" id="score-percentage">0%</p>
            </div>

            <div class="results-breakdown" aria-label="Score breakdown">
                <div class="breakdown-item correct">
                    <span class="breakdown-icon" aria-hidden="true">‚úì</span>
                    <span id="correct-count">0</span>
                    <span class="breakdown-label" data-i18n="results.correct">Correct</span>
                </div>
                <div class="breakdown-item incorrect">
                    <span class="breakdown-icon" aria-hidden="true">‚úó</span>
                    <span id="incorrect-count">0</span>
                    <span class="breakdown-label" data-i18n="results.incorrect">Incorrect</span>
                </div>
            </div>

            <!-- Question Review Toggle -->
            <button id="toggle-review" class="btn btn-secondary" aria-expanded="false" aria-controls="review-container">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <path d="M14 2v6h6"/>
                    <path d="M16 13H8"/>
                    <path d="M16 17H8"/>
                    <path d="M10 9H8"/>
                </svg>
                <span data-i18n="buttons.reviewAnswers">Review Answers</span>
            </button>

            <!-- Question Review Section -->
            <div id="review-container" class="review-container" hidden aria-label="Question review">
                <div id="review-list" class="review-list">
                    <!-- Review items will be inserted here -->
                </div>
            </div>

            <div class="results-actions">
                <button id="share-btn" class="btn btn-secondary" aria-label="Share your results as text">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <circle cx="18" cy="5" r="3"/>
                        <circle cx="6" cy="12" r="3"/>
                        <circle cx="18" cy="19" r="3"/>
                        <path d="M8.59 13.51l6.83 3.98"/>
                        <path d="M15.41 6.51l-6.82 3.98"/>
                    </svg>
                    <span data-i18n="buttons.share">Share</span>
                </button>
                <button id="share-image-btn" class="btn btn-secondary" aria-label="Share results as image">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <polyline points="21 15 16 10 5 21"/>
                    </svg>
                    <span data-i18n="buttons.shareImage">Share Image</span>
                </button>
                <button id="restart-btn" class="btn btn-primary">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                        <path d="M1 4v6h6M23 20v-6h-6"/>
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                    </svg>
                    <span data-i18n="buttons.playAgain">Play Again</span>
                </button>
            </div>
        </div>
    </section>
</main>

<!-- Share Toast -->
<div id="share-toast" class="toast" role="alert" aria-live="polite" hidden data-i18n="toast.copied">
    Results copied to clipboard!
</div>

<!-- Achievement Toast -->
<div id="achievement-toast" class="toast achievement-toast" role="alert" aria-live="polite">
    <span class="achievement-toast-icon">üèÜ</span>
    <div class="achievement-toast-content">
        <span class="achievement-toast-title" data-i18n="achievements.unlocked">Achievement Unlocked!</span>
        <span id="achievement-toast-name" class="achievement-toast-name"></span>
    </div>
</div>

<!-- Stats Modal -->
<div id="stats-modal" class="modal" hidden>
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <button class="modal-close" aria-label="Close modal">&times;</button>

        <!-- Modal Tabs -->
        <div class="modal-tabs" role="tablist">
            <button class="modal-tab active" data-tab="leaderboard" role="tab" aria-selected="true">üèÜ <span data-i18n="modal.leaderboard">Leaderboard</span></button>
            <button class="modal-tab" data-tab="achievements" role="tab" aria-selected="false">üéñÔ∏è <span data-i18n="modal.achievements">Achievements</span></button>
            <button class="modal-tab" data-tab="progress" role="tab" aria-selected="false">üìä <span data-i18n="modal.progress">Progress</span></button>
        </div>

        <!-- Leaderboard Tab -->
        <div id="tab-leaderboard" class="modal-tab-content active" role="tabpanel">
            <h2 data-i18n="stats.thisWeek">This Week</h2>
            <div id="weekly-summary" class="weekly-summary">
                <!-- Weekly summary will be rendered here -->
            </div>
            <h2 data-i18n="stats.lifetimeStats">Lifetime Stats</h2>
            <div class="lifetime-stats">
                <div class="lifetime-stat">
                    <span class="lifetime-stat-value" id="stat-total-quizzes">0</span>
                    <span class="lifetime-stat-label" data-i18n="stats.quizzesPlayed">Quizzes Played</span>
                </div>
                <div class="lifetime-stat">
                    <span class="lifetime-stat-value" id="stat-best-streak">0</span>
                    <span class="lifetime-stat-label" data-i18n="stats.bestStreak">Best Streak</span>
                </div>
                <div class="lifetime-stat">
                    <span class="lifetime-stat-value" id="stat-avg-time">-</span>
                    <span class="lifetime-stat-label" data-i18n="stats.avgTime">Avg Time/Question</span>
                </div>
                <div class="lifetime-stat">
                    <span class="lifetime-stat-value" id="stat-accuracy">-</span>
                    <span class="lifetime-stat-label" data-i18n="stats.accuracy">Accuracy</span>
                </div>
            </div>
            <h2 data-i18n="stats.topScores">Top Scores</h2>
            <div id="leaderboard-list" class="leaderboard-list">
                <!-- Leaderboard entries will be inserted here -->
            </div>
            <p id="leaderboard-empty" class="empty-state" hidden data-i18n="stats.noScores">No scores yet. Play a quiz to get on the leaderboard!</p>
        </div>

        <!-- Achievements Tab -->
        <div id="tab-achievements" class="modal-tab-content" role="tabpanel" hidden>
            <h2 class="tab-header-with-info">
                <span data-i18n="modal.achievements">Achievements</span>
                <span class="info-tooltip">
                    <button class="info-icon" aria-label="Achievement rules info">?</button>
                    <span class="info-tooltip-content">
                        <strong data-i18n="achievements.howToUnlock">How to unlock achievements:</strong><br><br>
                        <span data-i18n="achievements.howToUnlockDesc">Complete quizzes and hit milestones like perfect scores, answer streaks, or mastering countries.</span><br><br>
                        <strong data-i18n="achievements.masteringCountry">Mastering a country:</strong><br>
                        <span data-i18n="achievements.masteringCountryDesc">Answer questions about it 3+ times with 80%+ accuracy.</span>
                    </span>
                </span>
            </h2>
            <div class="achievements-summary">
                <span id="achievements-unlocked">0</span> / <span id="achievements-total">0</span> <span data-i18n="achievements.unlockedLabel">unlocked</span>
            </div>
            <div id="achievements-grid" class="achievements-grid">
                <!-- Achievement badges will be inserted here -->
            </div>
        </div>

        <!-- Progress Tab -->
        <div id="tab-progress" class="modal-tab-content" role="tabpanel" hidden>
            <h2 class="tab-header-with-info">
                <span data-i18n="progress.countryMastery">Country Mastery</span>
                <span class="info-tooltip">
                    <button class="info-icon" aria-label="Mastery rules info">?</button>
                    <span class="info-tooltip-content">
                        <strong data-i18n="progress.masteryLevels">Mastery Levels:</strong><br><br>
                        <strong data-i18n="progress.mastered">Mastered:</strong> <span data-i18n="progress.masteredDesc">80%+ correct over 3+ attempts</span><br>
                        <strong data-i18n="progress.learning">Learning:</strong> <span data-i18n="progress.learningDesc">50‚Äì79% correct</span><br>
                        <strong data-i18n="progress.weak">Weak:</strong> <span data-i18n="progress.weakDesc">Below 50% correct</span><br>
                        <strong data-i18n="progress.notSeen">Not Seen:</strong> <span data-i18n="progress.notSeenDesc">No attempts yet</span>
                    </span>
                </span>
            </h2>
            <div class="progress-summary">
                <div class="progress-stat">
                    <span id="progress-mastered" class="progress-stat-value">0</span>
                    <span class="progress-stat-label" data-i18n="progress.mastered">Mastered</span>
                </div>
                <div class="progress-stat">
                    <span id="progress-learning" class="progress-stat-value">0</span>
                    <span class="progress-stat-label" data-i18n="progress.learning">Learning</span>
                </div>
                <div class="progress-stat">
                    <span id="progress-new" class="progress-stat-value">0</span>
                    <span class="progress-stat-label" data-i18n="progress.notSeen">Not Seen</span>
                </div>
            </div>
            <div class="progress-filter">
                <button class="progress-filter-btn active" data-filter="all" data-i18n="progress.all">All</button>
                <button class="progress-filter-btn" data-filter="mastered" data-i18n="progress.mastered">Mastered</button>
                <button class="progress-filter-btn" data-filter="learning" data-i18n="progress.learning">Learning</button>
                <button class="progress-filter-btn" data-filter="weak" data-i18n="progress.weak">Weak</button>
            </div>
            <div id="progress-list" class="progress-list">
                <!-- Progress items will be inserted here -->
            </div>

            <div class="data-management">
                <h3 data-i18n="data.management">Data Management</h3>
                <div class="data-management-buttons">
                    <button id="export-data-btn" class="btn btn-secondary btn-small">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        <span data-i18n="data.export">Export Progress</span>
                    </button>
                    <label class="btn btn-secondary btn-small import-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <span data-i18n="data.import">Import Progress</span>
                        <input type="file" id="import-data-input" accept=".json" hidden>
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Data Migration Modal -->
<div id="migration-modal" class="modal" hidden>
    <div class="modal-overlay"></div>
    <div class="modal-content migration-modal-content">
        <div class="migration-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17 8 12 3 7 8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
        </div>
        <h2 data-i18n="migration.title">Data Found</h2>
        <p data-i18n="migration.message">We found existing progress data. What would you like to do?</p>

        <div class="migration-options">
            <button id="migration-cloud" class="migration-option">
                <div class="migration-option-icon">‚òÅÔ∏è</div>
                <div class="migration-option-text">
                    <strong data-i18n="migration.useCloud">Use Cloud Data</strong>
                    <span data-i18n="migration.useCloudDesc">Keep your synced progress, discard local data</span>
                </div>
            </button>
            <button id="migration-local" class="migration-option">
                <div class="migration-option-icon">üíæ</div>
                <div class="migration-option-text">
                    <strong data-i18n="migration.useLocal">Use Local Data</strong>
                    <span data-i18n="migration.useLocalDesc">Keep this device's progress, replace cloud data</span>
                </div>
            </button>
            <button id="migration-merge" class="migration-option recommended">
                <div class="migration-option-icon">üîÑ</div>
                <div class="migration-option-text">
                    <strong data-i18n="migration.merge">Merge Both</strong>
                    <span data-i18n="migration.mergeDesc">Combine local and cloud progress (Recommended)</span>
                </div>
            </button>
        </div>
    </div>
</div>

<!-- Reset Progress Confirmation Modal -->
<div id="reset-confirm-modal" class="modal" hidden>
    <div class="modal-overlay"></div>
    <div class="modal-content reset-confirm-modal-content">
        <div class="reset-confirm-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 9v4"/>
                <path d="M12 17h.01"/>
                <path d="M3.262 13.424a9.969 9.969 0 0 0 1.476 3.312A10 10 0 1 0 12 2c-2.373 0-4.548.827-6.262 2.212"/>
                <path d="M7 9l-4-1"/>
                <path d="M3 8v5h5"/>
            </svg>
        </div>
        <h2 data-i18n="reset.title">Reset Progress?</h2>
        <p data-i18n="reset.message">This will permanently delete all your progress, achievements, and leaderboard scores. This action cannot be undone.</p>

        <div class="reset-confirm-buttons">
            <button id="reset-cancel-btn" class="reset-confirm-btn reset-confirm-btn--cancel">
                <span data-i18n="reset.cancel">Cancel</span>
            </button>
            <button id="reset-confirm-btn" class="reset-confirm-btn reset-confirm-btn--danger">
                <span data-i18n="reset.confirm">Reset Everything</span>
            </button>
        </div>
    </div>
</div>

<!-- Delete Account Confirmation Modal -->
<div id="delete-account-modal" class="modal" hidden>
    <div class="modal-overlay"></div>
    <div class="modal-content delete-account-modal-content">
        <div class="delete-account-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 9v4"/>
                <path d="M12 17h.01"/>
                <path d="M3.586 3.586a2 2 0 0 1 2.828 0L12 9.172l5.586-5.586a2 2 0 1 1 2.828 2.828L14.828 12l5.586 5.586a2 2 0 1 1-2.828 2.828L12 14.828l-5.586 5.586a2 2 0 1 1-2.828-2.828L9.172 12 3.586 6.414a2 2 0 0 1 0-2.828z"/>
            </svg>
        </div>
        <h2 data-i18n="deleteAccount.title">Delete Account?</h2>
        <p data-i18n="deleteAccount.message">This will permanently delete your account and all associated data. You will be able to register again with the same email. This action cannot be undone.</p>

        <div class="delete-account-buttons">
            <button id="delete-account-cancel-btn" class="delete-account-btn delete-account-btn--cancel">
                <span data-i18n="deleteAccount.cancel">Cancel</span>
            </button>
            <button id="delete-account-confirm-btn" class="delete-account-btn delete-account-btn--danger">
                <span data-i18n="deleteAccount.confirm">Delete My Account</span>
            </button>
        </div>
    </div>
</div>

<!-- Edit Profile Modal -->
<div id="profile-modal" class="modal" hidden>
    <div class="modal-overlay"></div>
    <div class="modal-content profile-modal-content">
        <button id="profile-modal-close" class="modal-close" aria-label="Close">&times;</button>

        <h2 data-i18n="profile.title">Edit Profile</h2>

        <form id="profile-form" class="profile-form">
            <!-- Avatar Section -->
            <div class="profile-avatar-section">
                <div class="profile-avatar-wrapper">
                    <img id="profile-avatar-preview" class="profile-avatar-preview" src="" alt="Avatar" />
                    <div id="profile-avatar-placeholder" class="profile-avatar-placeholder">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                    </div>
                    <label class="profile-avatar-upload" for="profile-avatar-input">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                    </label>
                    <input type="file" id="profile-avatar-input" accept="image/*" hidden />
                </div>
                <p class="profile-avatar-hint" data-i18n="profile.avatarHint">Max 100KB. Larger images will be compressed.</p>
            </div>

            <!-- Name Fields -->
            <div class="profile-form-row">
                <div class="profile-form-group">
                    <label for="profile-firstname" data-i18n="profile.firstName">First Name</label>
                    <input type="text" id="profile-firstname" maxlength="50" />
                </div>
                <div class="profile-form-group">
                    <label for="profile-lastname" data-i18n="profile.lastName">Last Name</label>
                    <input type="text" id="profile-lastname" maxlength="50" />
                </div>
            </div>

            <!-- Nickname (Required) -->
            <div class="profile-form-group">
                <label for="profile-nickname">
                    <span data-i18n="profile.nickname">Nickname</span>
                    <span class="required-indicator">*</span>
                </label>
                <input type="text" id="profile-nickname" maxlength="30" required />
                <span class="profile-field-hint" data-i18n="profile.nicknameHint">This will be displayed in the app</span>
            </div>

            <!-- Location -->
            <div class="profile-form-group">
                <label for="profile-location" data-i18n="profile.location">Location</label>
                <input type="text" id="profile-location" maxlength="100" placeholder="City, Country" />
            </div>

            <!-- Age -->
            <div class="profile-form-group profile-form-group--small">
                <label for="profile-age" data-i18n="profile.age">Age</label>
                <input type="number" id="profile-age" min="1" max="120" />
            </div>

            <!-- Buttons -->
            <div class="profile-form-buttons">
                <button type="submit" id="profile-save-btn" class="profile-btn profile-btn--save" data-i18n="profile.save">Save Changes</button>
            </div>

            <!-- Error/Success Messages (after buttons to prevent layout shift) -->
            <div id="profile-error" class="profile-message profile-message--error" hidden></div>
            <div id="profile-success" class="profile-message profile-message--success" hidden></div>
        </form>
    </div>
</div>

<!-- Stats Button (visible on the start screen) -->
<button id="stats-btn" class="stats-btn" aria-label="View stats, achievements and leaderboard" title="Stats & Achievements">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
        <path d="M12 20V10"/>
        <path d="M18 20V4"/>
        <path d="M6 20v-4"/>
    </svg>
</button>

<footer class="footer">
    <p data-i18n="app.footer">Explore Europe, one capital at a time</p>
</footer>

<!-- Skip Link for Accessibility -->
<a href="#quiz-settings" class="skip-link">Skip to quiz settings</a>

<script type="module" src="/src/main.js"></script>
<script>
    // Register Service Worker (only in production, not dev server)
    if ('serviceWorker' in navigator && !location.port) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed:', err));
        });
    }
</script>
</body>
</html>